#include <stdio.h>
#include <string.h>
#include <pcap.h>
#include <stdlib.h>
#include "hacking.h"

void pcap_fatal( const char *failed_in, const char *errbuff )
{
    printf("Fatal error in %s : %s\n",failed_in,errbuff);
    exit(1);
}

int main(void)
{
    struct pcap_pkthdr header;
    const u_char *packet;
    char errbuff[PCAP_ERRBUF_SIZE];
    char *device;
    pcap_t *pcap_handle;

    device = pcap_lookupdev(errbuff);
    if ( device == NULL )
        pcap_fatal("Fatal in lookupdev",errbuff);
    printf("Sniffing on device %s\n",device);

    pcap_handle = pcap_open_live(device,4096,1,0,errbuff);
    if ( pcap_handle == NULL )
        pcap_fatal("pcap_open_live",errbuff);

    for ( int i = 0; i < 3; i++ )
    {
        packet = pcap_next( pcap_handle, &header );
        printf("Got a %d byte packet\n",header.len);
        dump( packet, header.len );
    }
}