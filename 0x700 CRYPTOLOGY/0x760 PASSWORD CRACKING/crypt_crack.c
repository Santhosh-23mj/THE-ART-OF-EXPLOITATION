#define _XOPEN_SOURCE
#include <unistd.h>
#include <stdio.h>

/*Barf a message and exit.*/
void barf(char *message, char *extra)
{
    printf(message,extra);
    exit(1);
}

/*A dictionary attack sample*/
int main( int argc, char *argv[] )
{
    FILE *wordlist;
    char *hash, word[30], salt[3];

    if( argc < 2 )
        barf("Usage : %s <wordlist> <hash>\n",argv[0]);

    strncpy(salt,argv[2],2);
    salt[2] = '\0';

    printf("Salt value is : \'%s\'\n",salt);

    if( (wordlist = fopen(argv[1],"r")) == NULL )
        barf("Fatal : Couldn't open file '%s'.\n",argv[1]);

    while(fgets(word,30,wordlist) != NULL)
    {
        word[strlen(word)-1] = '\0';
        hash = crypt(word,salt);
        printf("Trying word : %-30s ==> %15s\n",word,hash);
        if(strcmp(hash,argv[2]) == 0)
        {
            printf("The hash \"%s\" is from ",argv[2]);
            printf("plaintext password \"%s\".\n",word);
            fclose(wordlist);
            exit(0);
        }
    }

    printf("Couldn't find the plaintext in the wordlist. May be try a better one.\n");
    fclose(wordlist);
}