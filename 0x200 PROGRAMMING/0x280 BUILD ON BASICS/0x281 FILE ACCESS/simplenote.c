#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>

void prnerr(char *);
//Usage Function
void usage( char *prog_name, char *datafile )
{
    printf("Usage : %s \"<data to write to %s>\"\n",prog_name,datafile);
}

//Error checked memory allocation function
void *ec_malloc( unsigned int size )
{
    void *ptr;
    
    ptr = malloc(size);
    
    if ( ptr == NULL )
        prnerr("in malloc() while memory allocation");
    return ptr;
}

//Function to print fatal error messages
void prnerr( char *message )
{
    char error[100];
    
    strcpy(error,"[!!] Fatal Error ");
    strncat(error,message,83);
    perror(error);
    exit(-1);
}

//Beginning Main() function
int main(int argc,char *argv[])
{
    int fd;
    char *buffer,*datafile;
    
    buffer = (char *) ec_malloc(100);
    datafile = (char *) ec_malloc(20);
    
    //Writiing to datafile
    strcpy(datafile,"/tmp/notes");
    
    //Checking for Commandline Input
    if ( argc < 2 )
        usage(argv[0], datafile);
    
    strcpy(buffer,argv[1]);
    strncat(buffer,"\n",1);

    //Opening a file
    fd = open(datafile, O_WRONLY | O_CREAT | O_APPEND, S_IRUSR | S_IWUSR);
    if ( fd == -1 )
        prnerr("in main() while opening file");
    
    //Writing to the file
    if ( write(fd,buffer,strlen(buffer)) == -1 )
        prnerr("in main() while writing to file");
    
    //closing the file
    if ( close(fd) == -1 )
        prnerr("in main() while closing the file");
    
    printf("Notes has been saved\n");
    
    //freeing heap
    free(buffer);
    free(datafile);
    
}
