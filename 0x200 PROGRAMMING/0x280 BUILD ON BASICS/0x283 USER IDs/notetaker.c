#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include "hacking.h"

//Usage Function
void usage( char *prog_name, char *datafile )
{
    printf("Usage : %s \"<data to write to %s>\"\n",prog_name,datafile);
}

//Beginning Main() function
int main(int argc,char *argv[])
{
    int fd,uid;
    char *buffer,*datafile;
    
    buffer = (char *) ec_malloc(100);
    datafile = (char *) ec_malloc(20);
    
    //Writiing to datafile
    strcpy(datafile,"/var/notes");
    
    //Checking for Commandline Input
    if ( argc < 2 )
        usage(argv[0], datafile);
    
    strcpy(buffer,argv[1]);
    strncat(buffer,"\n",1);

    //Opening a file
    fd = open(datafile, O_WRONLY | O_CREAT | O_APPEND, S_IRUSR | S_IWUSR);
    if ( fd == -1 )
        prnerr("in main() while opening file");
    
    uid = getuid();
    
    //Writing to the file
    if (write( fd, &uid, 4 ) == -1 )
        prnerr("in main() while opening");
    write( fd, "\n", 1 );
    if ( write(fd,buffer,strlen(buffer)) == -1 )
        prnerr("in main() while writing to file");
    
    //closing the file
    if ( close(fd) == -1 )
        prnerr("in main() while closing the file");
    
    printf("Notes has been saved\n");
    
    //freeing heap
    free(buffer);
    free(datafile);
    
}
